---
const { currentPath } = Astro.props;
---

<header class="header">
	<div class="container">
		<nav class="nav">
			<a href="/" class="logo">
				<img src="/whiteFull.png" alt="Novana Insights" class="logo-image" />
			</a>
			
			<!-- Mobile menu button -->
			<button class="mobile-menu-button" id="mobile-menu-button" aria-label="Toggle menu">
				<span class="hamburger-line"></span>
				<span class="hamburger-line"></span>
				<span class="hamburger-line"></span>
			</button>
			
			<!-- Navigation links -->
			<div class="nav-links" id="nav-links">
				<a href="/" class={currentPath === '/' ? 'nav-link active' : 'nav-link'}>Home</a>
				<a href="/research" class={currentPath === '/research' ? 'nav-link active' : 'nav-link'}>Research</a>
				<a href="/about" class={currentPath === '/about' ? 'nav-link active' : 'nav-link'}>About</a>
				
				<!-- Dark mode toggle button -->
				<button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
					<svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="5"></circle>
						<line x1="12" y1="1" x2="12" y2="3"></line>
						<line x1="12" y1="21" x2="12" y2="23"></line>
						<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
						<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
						<line x1="1" y1="12" x2="3" y2="12"></line>
						<line x1="21" y1="12" x2="23" y2="12"></line>
						<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
						<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
					</svg>
					<svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
					</svg>
				</button>
			</div>
		</nav>
	</div>
</header>

<script>
	document.addEventListener('DOMContentLoaded', function() {
		const mobileMenuButton = document.getElementById('mobile-menu-button');
		const navLinks = document.getElementById('nav-links');
		const themeToggle = document.getElementById('theme-toggle');
		
		// Mobile menu functionality
		mobileMenuButton?.addEventListener('click', function() {
			navLinks?.classList.toggle('active');
			mobileMenuButton.classList.toggle('active');
		});
		
		// Close menu when clicking on a link
		const links = navLinks?.querySelectorAll('.nav-link');
		links?.forEach(link => {
			link.addEventListener('click', () => {
				navLinks?.classList.remove('active');
				mobileMenuButton?.classList.remove('active');
			});
		});
		
		// Close menu when clicking outside
		document.addEventListener('click', function(event) {
			if (!navLinks?.contains(event.target as Node) && !mobileMenuButton?.contains(event.target as Node)) {
				navLinks?.classList.remove('active');
				mobileMenuButton?.classList.remove('active');
			}
		});
		
		// Dark mode toggle functionality
		function updateTheme(isDark) {
			document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		}
		
		// Initialize theme from localStorage or system preference
		const savedTheme = localStorage.getItem('theme');
		const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
		const isDark = savedTheme ? savedTheme === 'dark' : systemDark;
		
		updateTheme(isDark);
		
		// Theme toggle button click handler
		themeToggle?.addEventListener('click', function() {
			const currentTheme = document.documentElement.getAttribute('data-theme');
			const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
			updateTheme(newTheme === 'dark');
		});
		
		// Listen for system theme changes
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
			if (!localStorage.getItem('theme')) {
				updateTheme(e.matches);
			}
		});
	});
</script>

<style>
	.header {
		background: var(--bg-white);
		position: sticky;
		top: 0;
		z-index: 100;
		border-bottom: 1px solid var(--border-color);
	}

	/* Pure black header in dark mode */
	[data-theme="dark"] .header {
		background: #000000 !important;
		border-bottom-color: #333333;
	}

	/* Pure black mobile nav in dark mode */
	[data-theme="dark"] .nav-links {
		background: #000000 !important;
	}

	.nav {
		display: flex;
		align-items: center;
		justify-content: space-between;
		height: 80px;
	}

	.logo {
		text-decoration: none;
		color: var(--text-primary);
		display: flex;
		align-items: center;
	}

	.logo-image {
		height: 42px;
		width: auto;
		transition: filter 0.3s ease;
	}

	/* Dark mode inversion for the logo */
	[data-theme="dark"] .logo .logo-image {
		filter: invert(1) !important;
	}

	/* Ensure logo works in dark mode even with specificity issues */
	html[data-theme="dark"] .logo-image {
		filter: invert(1) !important;
	}

	.mobile-menu-button {
		display: none;
		flex-direction: column;
		gap: 4px;
		background: none;
		border: none;
		cursor: pointer;
		padding: 8px;
		z-index: 101;
	}

	.hamburger-line {
		width: 24px;
		height: 2px;
		background: var(--text-primary);
		transition: all 0.3s ease;
		border-radius: 1px;
	}

	.mobile-menu-button.active .hamburger-line:nth-child(1) {
		transform: translateY(6px) rotate(45deg);
	}

	.mobile-menu-button.active .hamburger-line:nth-child(2) {
		opacity: 0;
	}

	.mobile-menu-button.active .hamburger-line:nth-child(3) {
		transform: translateY(-6px) rotate(-45deg);
	}

	.nav-links {
		display: flex;
		align-items: center;
		gap: 32px;
	}

	.nav-link {
		color: var(--text-secondary);
		text-decoration: none;
		font-weight: 500;
		transition: color 0.2s ease;
		position: relative;
		font-size: 15px;
	}

	.nav-link:hover,
	.nav-link.active {
		color: var(--text-primary);
	}

	.theme-toggle {
		background: none;
		border: none;
		cursor: pointer;
		padding: 8px;
		border-radius: 6px;
		display: flex;
		align-items: center;
		justify-content: center;
		color: var(--text-secondary);
		transition: all 0.2s ease;
		position: relative;
	}

	.theme-toggle:hover {
		color: var(--text-primary);
		background: var(--bg-light);
	}

	.theme-toggle .sun-icon,
	.theme-toggle .moon-icon {
		position: absolute;
		transition: all 0.3s ease;
	}

	/* Light mode - show sun icon */
	[data-theme="light"] .theme-toggle .sun-icon {
		opacity: 1;
		transform: rotate(0deg);
	}

	[data-theme="light"] .theme-toggle .moon-icon {
		opacity: 0;
		transform: rotate(180deg);
	}

	/* Dark mode - show moon icon */
	[data-theme="dark"] .theme-toggle .sun-icon {
		opacity: 0;
		transform: rotate(180deg);
	}

	[data-theme="dark"] .theme-toggle .moon-icon {
		opacity: 1;
		transform: rotate(0deg);
	}

	/* Mobile styles */
	@media (max-width: 768px) {
		.nav {
			padding: 0 var(--spacing-md); /* Add padding for mobile */
		}
		
		.mobile-menu-button {
			display: flex;
			min-height: 44px; /* Better touch target */
			min-width: 44px;
			padding: 12px;
		}
		
		.nav-links {
			position: fixed;
			top: 80px;
			right: 0;
			left: 0; /* Full width on mobile */
			width: 100%; /* Full width */
			background: var(--bg-white);
			flex-direction: column;
			gap: 0;
			padding: var(--spacing-lg) 0;
			transform: translateY(-100%); /* Slide down instead of right */
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s ease;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
			border-bottom: 1px solid var(--border-color);
			max-height: calc(100vh - 80px); /* Prevent overflow */
			overflow-y: auto;
		}
		
		.nav-links.active {
			transform: translateY(0); /* Slide down */
			opacity: 1;
			visibility: visible;
		}
		
		.nav-link {
			padding: 16px var(--spacing-lg); /* Larger touch targets */
			font-size: 18px; /* Larger text for readability */
			color: var(--text-primary);
			text-align: left; /* Left align on mobile */
			display: block;
			width: 100%;
			min-height: 48px; /* Better touch target */
			border-bottom: 1px solid var(--border-color);
		}
		
		.nav-link:last-of-type {
			border-bottom: none;
		}
		
		.nav-link:hover,
		.nav-link.active {
			color: var(--text-primary);
			background: var(--bg-light);
		}
		
		.nav-link.active::after {
			display: none;
		}
		
		.theme-toggle {
			margin: var(--spacing-md) var(--spacing-lg);
			justify-content: flex-start; /* Left align theme toggle */
			min-height: 48px;
			padding: 12px;
			border-top: 1px solid var(--border-color);
		}
		
		.logo-image {
			height: 36px; /* Slightly smaller on mobile */
		}
	}
	
	/* Small phones */
	@media (max-width: 480px) {
		.nav {
			padding: 0 var(--spacing-sm);
		}
		
		.nav-link {
			padding: 14px var(--spacing-md);
			font-size: 16px;
		}
		
		.theme-toggle {
			margin: var(--spacing-md);
		}
		
		.logo-image {
			height: 32px; /* Even smaller on small phones */
		}
	}
</style>